name: Proxy Check

on:
  # å®šæ—¶è§¦å‘ï¼šæ¯ 30 åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡
  # schedule:
  #   - cron: '*/30 * * * *'
  
  # æ‰‹åŠ¨è§¦å‘é€‰é¡¹
  workflow_dispatch:
    description: 'æ‰‹åŠ¨æ‰§è¡Œä»£ç†æ£€æµ‹'

  # å½“ä»£ç æŽ¨é€åˆ° main åˆ†æ”¯æ—¶ä¹Ÿæ‰§è¡Œï¼ˆå¯é€‰ï¼‰
  # push:
  #   branches: [ main ]
  #   paths:
  #     - 'check_domain.py'
  #     - '.github/workflows/proxy-check.yml'

env:
  # Python ç‰ˆæœ¬
  PYTHON_VERSION: '3.10'

jobs:
  check-proxies:
    name: æ£€æµ‹ä»£ç†å¯ç”¨æ€§
    runs-on: ubuntu-latest
    
    # è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œé¿å…é•¿æ—¶é—´è¿è¡Œï¼ˆç›´æŽ¥ä½¿ç”¨æ•°å­—ï¼Œä¸æ”¯æŒè¡¨è¾¾å¼ï¼‰
    timeout-minutes: 10
    
    steps:
      - name: æ£€å‡ºä»£ç 
        uses: actions/checkout@v4
        
      - name: è®¾ç½® Python ${{ env.PYTHON_VERSION }}
        uses: actions/setup-python@v4
        with:
          python-version: ${{ env.PYTHON_VERSION }}
          cache: 'pip'
          
      - name: å®‰è£…ä¾èµ–
        run: |
          python -m pip install --upgrade pip
          pip install requests
          
      - name: æ˜¾ç¤º Python ç‰ˆæœ¬å’Œä¾èµ–
        run: |
          python --version
          pip list | grep requests
          
      - name: æ‰§è¡Œä»£ç†æ£€æµ‹è„šæœ¬
        run: |
          echo "ðŸŽ¯ å¼€å§‹æ‰§è¡Œä»£ç†æ£€æµ‹è„šæœ¬..."
          echo "========================================"
          python check_domain.py
          echo "========================================"
          echo "âœ… è„šæœ¬æ‰§è¡Œå®Œæˆ"
          
      - name: ä¿å­˜æ‰§è¡Œæ—¶é—´
        if: always()
        run: |
          echo "æ£€æµ‹å®Œæˆæ—¶é—´: $(date '+%Y-%m-%d %H:%M:%S')" >> execution_log.txt
          
      - name: ä¸Šä¼ æ‰§è¡Œæ—¥å¿—
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: proxy-check-logs
          path: |
            execution_log.txt
          retention-days: 7